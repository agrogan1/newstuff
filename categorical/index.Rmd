---
title: "Categorical Data Analysis"
description: |
  Materials for a course on categorical data analysis.
author:
  - name: Andy Grogan-Kaylor 
    url: https://agrogan1.github.io/
    affiliation: University of Michigan
    affiliation_url: https://umich.edu/
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    highlight: haddock
    toc: yes
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)

```

```{css, echo=FALSE}

d-article blockquote {
  color: black;
  border-left: 2px solid gold; 
  padding: 0.5em 10px;
  }
  
```

```{r}

library(ggplot2)

library(ggthemes)

library(dplyr)

library(plotly)

library(knitr)

library(rgl)

library(rayshader)

```


```{r}

x <- seq(-10, 10, by = 0.25)

y <- exp(x)/(1 + exp(x))

myprobability <- round(y, digits = 5)

p1 <- ggplot(data = NULL,
             aes(x = x,
             y = myprobability,
             color = myprobability)) + 
  geom_point() +
  scale_color_viridis_c(name = "probability") +
  labs(title = "Logistic Curve",
       x = "x",
       y = "probability") +
  theme_minimal() + 
  theme(legend.position = "none")
  
# ggplotly(p1)

ggsave(p1 + 
         theme(title = element_text(size = rel(.5)),
               axis.text.y = element_text(size = rel(.5))), 
       filename = "logistic.png", 
       height = 1.25)

ggsave(p1 + 
         theme(aspect.ratio = 1),
       filename = "logistic-square.png")
  
```


```{r, fig.cap="Manipulable Diagram of Logistic Curve"}

knit_hooks$set(webgl = hook_webgl)

rayshader::plot_gg(p1, zoom = .8) 

rglwidget()
 
```

```{r, eval=FALSE}

rayshader::plot_gg(p1, zoom = .8) %>%
  render_movie(filename = "logistic",
               type = "orbit",
               frames = 360,
               fps = 30)

```

```{r, eval=FALSE}

y2 <- round(pnorm(x), digits = 5)

p2 <- ggplot(data = NULL,
             aes(x = x,
             y = y2,
             color = y2)) + 
  geom_point() +
  scale_color_viridis_c(name = "probability") +
  labs(title = "Probit Curve",
       x = "x",
       y = "probability") +
  theme_minimal() + 
  theme(legend.position = "none")

p2
  
```

```{r, eval=FALSE}

rayshader::plot_gg(p2, zoom = .8) %>%
  render_movie(filename = "probit",
               type = "orbit",
               frames = 360,
               fps = 30)

```

```{r, eval=FALSE}

x3 <- rnbinom(10000, mu = 4, size = 1)

mydata <- data.frame(x3)

p3 <- mydata %>%
  count(x3) %>%
  ggplot(aes(x = x3,
             y = n,
             color = n)) + 
  geom_point() +
  scale_color_viridis_c() +
  labs(title = "Negative Binomial \nDistribution",
       x = "x",
       y = "count") +
  theme_minimal() +
  theme(legend.position = "none")

p3

```

```{r, eval=FALSE}

y3 <- .01 * exp(x)

p4 <- ggplot(data = NULL,
             aes(x = x,
             y = y3,
             color = y3)) + 
  geom_point() +
  scale_color_viridis_c() +
  labs(title = "Negative Binomial \nCurve",
       x = "x",
       y = "count") +
  theme_minimal() +
  theme(legend.position = "none")

p4
  
```


```{r, eval=FALSE}

rayshader::plot_gg(p3, zoom = .8) %>%
  render_movie(filename = "negative-binomial-distribution",
               type = "orbit",
               frames = 360,
               fps = 30)


```

```{r, eval=FALSE}

rayshader::plot_gg(p4, zoom = .8) %>%
  render_movie(filename = "negative-binomial",
               type = "orbit",
               frames = 360,
               fps = 30)

```

```{r, eval=FALSE}

save(x, y, myprobability, y2, y3, x3,
     p1, p2, p3, p4,
     file = "glm.RData")

```

> <span style="background-color:yellow">Instruction will be conducted in Stata, so basic knowledge of descriptive statistics and OLS in Stata is a prerequisite.</span>

<aside>
Our organizing question: "What is the chance that bad thing *x* will happen? What is the chance that good thing *y* will happen?
</aside>

> Lecture slides and handouts are [here](./README.html), and are free to share and download as long as you cite their source.

<aside>
Because so many of the outcomes we study are so important, we want to make sure our answers are as precise, and as close to correct, as we can make them.
</aside>

Researchers are most commonly aware of methods that are suitable for continuous dependent variables (e.g. mental health scores), such as the use of ordinary least squares regression. However, many outcomes of interest to social workers, and other social researchers, are decidedly not continuous, but are dichotomous or binary in nature, often representing important life events: born; died; entered the program; left the program; received a particular mental or physical health diagnosis; maltreatment or adverse event occurred; voted for a particular candidate or position; conflict or protest began; conflict or protest ended[^discuss]. Many researchers are familiar with the basics of logistic regression, yet do not have a grounding in some of the intricacies of logistic regression, such as generating predicted probabilities, or using interaction terms in a categorical model, which can lead to clearer and more accurate reporting of results. 

<aside>
```{r, fig.cap="The Nautilus Shell: Simple Seeming Questions Contain Hidden Complexities"}

knitr::include_graphics("NautilusCutawayLogarithmicSpiral.jpg")

```
</aside>

> In this course I try to thread the needle between exploring the statistical intricacies of these models, and discussing how a better understanding of categorical data analysis can help us make more accurate conclusions about the substantive issues that we care about.

Further, the basic logistic regression model serves as the foundation for a wide variety of more advanced statistical approaches that can help advance social research. Study of the logistic regression model can lead to variations of logistic regression such as logistic regression for ordered variables, or multinomial logistic regression where there are more than two categories of the outcome variable (e.g. multiple forms of family violence). An understanding of logistic regression also helps to motivate understanding of models for count data such as the Poisson and negative binomial model suitable for studying counts of events such as incidence of disease or incidence of violence. Lastly, categorical data models serve as the foundation for event history models that are used to study the timing of events, such as the timing of program entry, program departure, receipt of a diagnosis, or the timing of conflict or protest.

[^discuss]: I do not have data sets readily available on all of these issues, but we can certainly *discuss* how the models discussed in this course might be applied to any of these issues.













